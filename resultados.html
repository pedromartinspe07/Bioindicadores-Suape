<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados | BioIndicadores Suape</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="images/favicon.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="images/logo.png" alt="Logo BioIndicadores Suape">
            <h1>BioIndicadores Suape</h1>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="projeto.html">O Projeto</a></li>
                <li><a href="referencial.html">Referencial</a></li>
                <li><a href="resultados.html" class="active">Resultados</a></li>
                <li><a href="sobre.html">Sobre</a></li>
                <li><a href="publicacoes.html">Publicações</a></li>
                <li><a href="dados.html">Dados</a></li>
                <li><a href="glossario.html">Glossário</a></li>
                <li><a href="contato.html">Contato</a></li>
            </ul>
        </nav>
        <div class="search-container">
            <form id="search-form" class="search-form">
                <input type="text" 
                       id="search-input" 
                       placeholder="Pesquisar publicações..." 
                       aria-label="Search">
                <button type="submit" aria-label="Submit search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </form>
            <div id="search-results" class="search-results"></div>
        </div>
    </header>

    <main>
        <section class="content-section">
            <h2>Resultados Preliminares</h2>
            
            <article class="results-card">
                <h3>Dados Biológicos</h3>
                <div class="chart-controls">
                    <label for="speciesFilter">Filtrar por Espécie:</label>
                    <select id="speciesFilter"></select>
                </div>
                <div class="chart-container">
                    <canvas id="speciesChart"></canvas>
                </div>
                <p class="chart-caption">Figura 1: Abundância e Índice de Saúde por Espécie e Estação de Amostragem</p>
            </article>

            <article class="results-card">
                <h3>Parâmetros Físico-Químicos ao Longo do Tempo</h3>
                <div class="chart-controls">
                    <label for="paramFilter">Selecionar Parâmetro:</label>
                    <select id="paramFilter">
                        <option value="Oxigenio">Oxigênio (mg/L)</option>
                        <option value="pH">pH</option>
                        <option value="Turbidez">Turbidez (NTU)</option>
                        <option value="Metais">Metais (ppm)</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="timeSeriesChart"></canvas>
                </div>
                <p class="chart-caption">Figura 2: Variação dos parâmetros físico-químicos ao longo do tempo</p>
            </article>

            <article class="results-card">
                <h3>Correlação entre Parâmetros</h3>
                <div class="chart-controls">
                    <label for="xParam">Eixo X:</label>
                    <select id="xParam">
                        <option value="Oxigenio">Oxigênio (mg/L)</option>
                        <option value="pH">pH</option>
                        <option value="Turbidez">Turbidez (NTU)</option>
                        <option value="Metais">Metais (ppm)</option>
                        <option value="Abundancia">Abundância Bioindicador</option>
                        <option value="Indice_Saude">Índice de Saúde Bioindicador</option>
                    </select>
                    <label for="yParam">Eixo Y:</label>
                    <select id="yParam">
                        <option value="Indice_Saude">Índice de Saúde Bioindicador</option>
                        <option value="Oxigenio">Oxigênio (mg/L)</option>
                        <option value="pH">pH</option>
                        <option value="Turbidez">Turbidez (NTU)</option>
                        <option value="Metais">Metais (ppm)</option>
                        <option value="Abundancia">Abundância Bioindicador</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="scatterChart"></canvas>
                </div>
                <p class="chart-caption">Figura 3: Correlação entre parâmetros selecionados</p>
            </article>
            
            <article class="results-card">
                <h3>Parâmetros Físico-Químicos</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Estação</th>
                            <th>Oxigênio (mg/L)</th>
                            <th>pH</th>
                            <th>Turbidez (NTU)</th>
                            <th>Metais (ppm)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>E1 - Portuária</td>
                            <td>4.2</td>
                            <td>7.8</td>
                            <td>28</td>
                            <td>0.45</td>
                        </tr>
                        <tr>
                            <td>E2 - Manguezal</td>
                            <td>5.8</td>
                            <td>7.2</td>
                            <td>15</td>
                            <td>0.12</td>
                        </tr>
                        <tr>
                            <td>E3 - Controle</td>
                            <td>6.5</td>
                            <td>7.5</td>
                            <td>8</td>
                            <td>0.03</td>
                        </tr>
                    </tbody>
                </table>
            </article>
            
            <article class="results-card download-section">
                <h3>Dados Completos</h3>
                <div class="download-options">
                    <a href="data/dados_brutos.csv" class="download-btn">
                        <img src="images/csv-icon.png" alt="CSV">
                        Planilha Completa (CSV)
                    </a>
                    <a href="data/relatorio_tecnico.pdf" class="download-btn">
                        <img src="images/pdf-icon.png" alt="PDF">
                        Relatório Técnico (PDF)
                    </a>
                </div>
            </article>

            <article class="results-card">
                <h3>Interpretação e Recomendações</h3>
                <p>A análise dos bioindicadores aquáticos revela padrões claros da saúde ecossistêmica nas áreas de influência do Porto de Suape. Observamos que:</p>
                <ul>
                    <li>Em estações próximas às operações portuárias (E1, E2), há uma **redução na abundância e diversidade de espécies sensíveis**, e um **aumento na prevalência de espécies tolerantes** à poluição. Isso se correlaciona com níveis mais elevados de metais pesados e turbidez na água.</li>
                    <li>O **Índice de Saúde (AMBI)** nas estações impactadas é consistentemente inferior, indicando um estado ecológico moderado a pobre, enquanto a estação controle (E3) mantém um índice de boa qualidade.</li>
                    <li>A variação temporal dos parâmetros físico-químicos mostra picos de poluição que podem ser associados a eventos específicos ou à sazonalidade das operações portuárias.</li>
                </ul>
                <p>Com base nesses resultados, a pesquisa propõe as seguintes recomendações para aprimorar a gestão ambiental na região de Suape:</p>
                <ol>
                    <li>**Monitoramento Contínuo e Integrado**: Manter e expandir as estações de monitoramento, incluindo análises mais frequentes de bioindicadores e poluentes específicos.</li>
                    <li>**Controle de Efluentes e Dragagem**: Implementar tecnologias mais eficazes para o tratamento de efluentes industriais e portuários, além de práticas de dragagem que minimizem a resuspensão de sedimentos contaminados.</li>
                    <li>**Programas de Recuperação de Hábitats**: Desenvolver projetos de restauração de manguezais e outros ecossistemas costeiros degradados, que atuam como filtros naturais e berçários de vida marinha.</li>
                    <li>**Educação Ambiental e Engajamento**: Fortalecer programas de conscientização para a comunidade local e stakeholders portuários sobre a importância dos bioindicadores e a conservação marinha.</li>
                    <li>**Pesquisa e Desenvolvimento**: Incentivar estudos adicionais para identificar novos bioindicadores e compreender melhor os efeitos de longo prazo dos impactos cumulativos na região.</li>
                </ol>
                <p>Acreditamos que a aplicação dessas recomendações, baseadas em evidências científicas, contribuirá significativamente para a sustentabilidade ambiental do Porto de Suape e a saúde de seus ecossistemas costeiros.</p>
            </article>

            <article class="results-card">
                <h3>Limitações do Estudo e Perspectivas Futuras</h3>
                <p>Todo estudo científico possui inerentemente suas limitações, e o nosso projeto não é diferente. Reconhecemos que a compreensão completa dos ecossistemas costeiros em uma área tão dinâmica quanto Suape é um desafio contínuo. As principais limitações incluem:</p>
                <ul>
                    <li>**Escala Temporal e Espacial**: Embora a amostragem seja regular, a complexidade dos fenômenos ambientais pode exigir monitoramento em escalas temporais ainda mais finas e uma rede de estações mais densa para capturar eventos de curta duração ou micro-ambientes.</li>
                    <li>**Bioindicadores Específicos**: A seleção dos bioindicadores atuais, embora robusta, pode não abranger todas as respostas biológicas ou todos os grupos taxonômicos sensíveis. Novas pesquisas podem identificar bioindicadores mais específicos para certos tipos de poluentes ou impactos.</li>
                    <li>**Variabilidade Natural**: A distinção clara entre impactos antropogênicos e variabilidade natural (ex: sazonalidade, eventos climáticos extremos) é um desafio, exigindo séries históricas de dados mais longas para uma análise mais robusta.</li>
                    <li>**Sinergismo e Antagonismo de Poluentes**: A interação complexa entre diferentes poluentes (sinergismo ou antagonismo) nem sempre é totalmente compreendida pelos métodos atuais, podendo subestimar ou superestimar certos impactos.</li>
                </ul>
                <p>Com base nessas considerações, delineamos algumas perspectivas para futuras pesquisas e aprimoramento do monitoramento:</p>
                <ol>
                    <li>**Modelagem Preditiva**: Desenvolvimento de modelos preditivos para antecipar cenários de impacto e avaliar a eficácia de diferentes estratégias de mitigação.</li>
                    <li>**Integração de Novas Tecnologias**: Exploração de tecnologias como sensoriamento remoto, eDNA (DNA ambiental) e biosensores para um monitoramento mais eficiente e de alta resolução.</li>
                    <li>**Avaliação Socioeconômica**: Integrar análises dos impactos socioeconômicos nas comunidades pesqueiras e tradicionais, proporcionando uma visão mais holística da sustentabilidade na região.</li>
                    <li>**Colaboração Interinstitucional**: Fortalecer a parceria com outras instituições de pesquisa, órgãos ambientais e a própria comunidade para maximizar o alcance e a relevância dos estudos.</li>
                </ol>
            </article>
        </section>
    </main>

    <footer>
        <p>Contato: bioindicadoressuape@gmail.com</p>
        <p>© <span id="current-year">2025</span> BioIndicadores Suape. Todos os direitos reservados.</p>
    </footer>

    <script src="js/utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            let bioindicatorsData = [];
            let timeSeriesData = [];

            // Load both datasets
            try {
                bioindicatorsData = await parseCSV('dados/bioindicadores_mock.csv');
                timeSeriesData = await parseCSV('dados/time_series_mock.csv');
            } catch (error) {
                console.error('Erro ao carregar dados CSV:', error);
                document.getElementById('speciesChart').parentElement.innerHTML = '<p>Erro ao carregar dados para os gráficos.</p>';
                return;
            }

            // --- Chart 1: Dados Biológicos (Species Chart) ---
            const speciesChartCtx = document.getElementById('speciesChart').getContext('2d');
            let speciesChart;

            const speciesFilter = document.getElementById('speciesFilter');
            const uniqueSpecies = [...new Set(bioindicatorsData.map(row => row.Especie_Bioindicadora))];
            uniqueSpecies.forEach(species => {
                const option = document.createElement('option');
                option.value = species;
                option.textContent = species;
                speciesFilter.appendChild(option);
            });

            function renderSpeciesChart(filterSpecies = null) {
                const filteredData = filterSpecies ? bioindicatorsData.filter(row => row.Especie_Bioindicadora === filterSpecies) : bioindicatorsData;

                const labels = filteredData.map(row => row.Estacao + ' - ' + row.Especie_Bioindicadora);
                const abundancia = filteredData.map(row => parseFloat(row.Abundancia));
                const indiceSaude = filteredData.map(row => parseFloat(row.Indice_Saude));

                if (speciesChart) {
                    speciesChart.destroy();
                }

                speciesChart = new Chart(speciesChartCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Abundância',
                                data: abundancia,
                                backgroundColor: 'rgba(0, 86, 122, 0.8)', // Primary-like color, slightly opaque
                                borderColor: 'rgba(0, 86, 122, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Índice de Saúde',
                                data: indiceSaude,
                                backgroundColor: 'rgba(26, 143, 159, 0.8)', // Secondary-like color, slightly opaque
                                borderColor: 'rgba(26, 143, 159, 1)',
                                borderWidth: 1,
                                yAxisID: 'y1',
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Abundância' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: true,
                                grid: { drawOnChartArea: false },
                                title: { display: true, text: 'Índice de Saúde' },
                                min: 0,
                                max: 1
                            }
                        },
                        plugins: {
                            zoom: {
                                zoom: {
                                    wheel: { enabled: true },
                                    pinch: { enabled: true },
                                    mode: 'x',
                                },
                                pan: {
                                    enabled: true,
                                    mode: 'x',
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.y !== null) { label += context.parsed.y; }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            speciesFilter.addEventListener('change', (e) => {
                renderSpeciesChart(e.target.value === '' ? null : e.target.value);
            });

            renderSpeciesChart();

            // Reset Zoom button for Species Chart
            const resetSpeciesZoomBtn = document.createElement('button');
            resetSpeciesZoomBtn.textContent = 'Reset Zoom';
            resetSpeciesZoomBtn.className = 'reset-zoom-btn';
            document.querySelector('#speciesChart').closest('.chart-container').insertAdjacentElement('afterend', resetSpeciesZoomBtn);
            resetSpeciesZoomBtn.addEventListener('click', () => speciesChart.resetZoom());

            // --- Chart 2: Parâmetros Físico-Químicos ao Longo do Tempo (Time Series Chart) ---
            const timeSeriesChartCtx = document.getElementById('timeSeriesChart').getContext('2d');
            let timeSeriesChart;

            const paramFilter = document.getElementById('paramFilter');

            // Define a professional color palette for time series
            const timeSeriesColors = [
                '#00567a', // Primary color
                '#1a8f9f', // Secondary color
                '#72bf44', // A good complementary green
                '#f39c12'  // A warning-like yellow/orange
            ];

            function renderTimeSeriesChart(selectedParam = 'Oxigenio') {
                const labels = [...new Set(timeSeriesData.map(row => row.Data))].sort();
                const datasets = timeSeriesData.reduce((acc, row) => {
                    if (!acc[row.Estacao]) {
                        // Assign colors from the predefined palette
                        const colorIndex = Object.keys(acc).length % timeSeriesColors.length;
                        acc[row.Estacao] = {
                            label: `Estação ${row.Estacao}`,
                            data: [],
                            borderColor: timeSeriesColors[colorIndex],
                            backgroundColor: timeSeriesColors[colorIndex] + '40', // Slightly transparent fill
                            fill: false
                        };
                    }
                    acc[row.Estacao].data.push({ x: row.Data, y: parseFloat(row[selectedParam]) });
                    return acc;
                }, {});

                if (timeSeriesChart) {
                    timeSeriesChart.destroy();
                }

                timeSeriesChart = new Chart(timeSeriesChartCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: Object.values(datasets)
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { type: 'time', time: { unit: 'month' }, title: { display: true, text: 'Data' } },
                            y: { beginAtZero: true, title: { display: true, text: selectedParam } }
                        },
                        plugins: {
                            zoom: {
                                zoom: {
                                    wheel: { enabled: true },
                                    pinch: { enabled: true },
                                    mode: 'x',
                                },
                                pan: {
                                    enabled: true,
                                    mode: 'x',
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.y !== null) { label += context.parsed.y; }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            paramFilter.addEventListener('change', (e) => {
                renderTimeSeriesChart(e.target.value);
            });

            renderTimeSeriesChart();

            // Reset Zoom button for Time Series Chart
            const resetTimeSeriesZoomBtn = document.createElement('button');
            resetTimeSeriesZoomBtn.textContent = 'Reset Zoom';
            resetTimeSeriesZoomBtn.className = 'reset-zoom-btn';
            document.querySelector('#timeSeriesChart').closest('.chart-container').insertAdjacentElement('afterend', resetTimeSeriesZoomBtn);
            resetTimeSeriesZoomBtn.addEventListener('click', () => timeSeriesChart.resetZoom());

            // --- Chart 3: Correlação entre Parâmetros (Scatter Chart) ---
            const scatterChartCtx = document.getElementById('scatterChart').getContext('2d');
            let scatterChart;

            const xParamSelect = document.getElementById('xParam');
            const yParamSelect = document.getElementById('yParam');

            function renderScatterChart() {
                const xParam = xParamSelect.value;
                const yParam = yParamSelect.value;

                const combinedData = [];
                // For simplicity, combine relevant data. In a real scenario, ensure data alignment.
                // For now, let's assume `bioindicatorsData` and `timeSeriesData` can be joined by 'Estacao' if needed.
                // Here, we'll just use the available numeric data.
                
                // Example: Using bioindicatorsData for scatter plot
                bioindicatorsData.forEach(row => {
                    if (row[xParam] && row[yParam]) {
                        combinedData.push({
                            x: parseFloat(row[xParam]),
                            y: parseFloat(row[yParam]),
                            label: row.Estacao + ' - ' + row.Especie_Bioindicadora
                        });
                    }
                });

                // You might need to extend this to include data from timeSeriesData as well,
                // or from original data if it has all parameters in one place.
                
                if (scatterChart) {
                    scatterChart.destroy();
                }

                scatterChart = new Chart(scatterChartCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: `Correlação ${xParam} vs ${yParam}`,
                            data: combinedData,
                            backgroundColor: 'rgba(0, 86, 122, 0.7)', // Primary color for scatter points
                            borderColor: 'rgba(0, 86, 122, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: { display: true, text: xParam }
                            },
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: yParam }
                            }
                        },
                        plugins: {
                            zoom: {
                                zoom: {
                                    wheel: { enabled: true },
                                    pinch: { enabled: true },
                                    mode: 'xy', // Enable zoom on both axes for scatter plot
                                },
                                pan: {
                                    enabled: true,
                                    mode: 'xy', // Enable pan on both axes for scatter plot
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.raw.label + `: (${context.raw.x}, ${context.raw.y})`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            xParamSelect.addEventListener('change', renderScatterChart);
            yParamSelect.addEventListener('change', renderScatterChart);

            renderScatterChart();

            // Reset Zoom button for Scatter Chart
            const resetScatterZoomBtn = document.createElement('button');
            resetScatterZoomBtn.textContent = 'Reset Zoom';
            resetScatterZoomBtn.className = 'reset-zoom-btn';
            document.querySelector('#scatterChart').closest('.chart-container').insertAdjacentElement('afterend', resetScatterZoomBtn);
            resetScatterZoomBtn.addEventListener('click', () => scatterChart.resetZoom());

            // Removed getRandomColor as it's no longer needed for time series
            /*
            function getRandomColor() {
                const letters = '0123456789ABCDEF';
                let color = '#';
                for (let i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }
            */
        });
    </script>
</body>
</html>
